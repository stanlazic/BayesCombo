---
title: "BayesCombo: A Quick Guide"
author: "Bruno Contrino & Stanley Lazic"
date: "18 July 2016"
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: FALSE
vignette: >
  %\VignetteIndexEntry{BayesCombo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE, warning= FALSE,message=FALSE}
library(BayesCombo)
```

# Introduction 

This vignette gives a basic walkthrough on the __BayesCombo__ package. The method combines evidence from multiple studies using Bayes Factors and is based on a method described by Kuiper et al. [1]. 

For a detailed explanation on the package and all of its code please see the __BayesCombo-Walkthrough__ vignette. 


# Package Functions 

### Calculate.PMP 

This function is the basis of the __BayesCombo__ package as it calculates the updated posterior model probabilities for the given inputs. It is advised to run this as function first and store the results in a variable. The function carries out the main pipeline and the object which is returned will include the final results and returns an object of class "BFcombo" with multiple sections. 

#### Inputs

**beta**

This is a vector of the effect sizes from the various studies which will be combined. 

**se.beta**

This is a vector of variances from the studies which will be combined. 

**beta0**

This is the prior mean and is usually set at 0. 

**pi0**

This is a vector of length three containing the prior model probabilities for each hypothesis. This must sum to 1 and it is advised to set this as `rep(1/3 , 3)`.

**percent** 

This sets the size of the percentage confidence intervals used to calculate the prior model variances. The default is 99 %.  

#### Output 

The calculate PMP function returns an object of class "BFcombo" with the following sections:

**beta**

This is a vector of the effect sizes from the various studies which will be combined. 

**se.beta**

This is a vector of varianes from the studies which will be combined. 

**beta0**

This is the prior mean and is usually set at 0. 

**pi0**

This is a vector of length three containing the prior model probabilities for each hypothesis. This must sum to 1 and it is advised to set this as `rep(1/3 , 3)`. 

**var0** 

This is a vector of the prior variances which have been computed. 

**percent**
 
This is the percentage used to calculate the prior variances and reflects the percentage confidence interval taken to compute the results in var0.

**unBetaPost**

This is a vector of unconstrained posterior means. 

**unVarPost**

This is a vector of unconstrained posterior variances. 

**BFmu**

This is a matrix of the unconstrained Bayes factors for each hypothesis per study.

**PMP**

This is a `3 x Number of Studies` matrix which gives the updated posterior model probabilities (PMP) and is the the final step of the pipeline. The last column of the matrix are the final PMP values.

#### Example

```{r calculatePMP}

 x <- calculate.PMP(beta = c(0.0126474408, 5.0051724138, 1.2975612498, 0.0004762455),
        se.beta = c(2.538974e-03, 6.662216e+00, 4.219142e+00, 6.963380e-06),
    beta0 = 0, pi0 = rep(1/3,3) )
 x
```

### BSfactor

This function is named after the Bayes Safety factor which aim s to show, given a threshold, how much weight you can give a certain hypothsis in the prior model probabilities. This can aid making a conclusion on the outcome of the standard analysis. 

#### Inputs 

This function can take two kinds of inputs: numerical vectors and objects of class "BFcombo" which will be created by running the `calculate.PMP` function. 

**beta**

This is a vector of the effect sizes from the various studies which will be combined.

beta can also be an object of class "BFcombo".

**se.beta**

This is a vector of variances from the studies which will be combined. 
In the case that beta is of class "BFcombo", se.beta will take its default value of NULL.


**beta0**

This is the prior mean and its default is 0. 

**n** 

This is the number of steps from 0.33333 to 0.99999 which the prior model probabilities will take. The default is 100. 

**threshold** 

This is a value between 0 and 1 which will be used to set the boundary point at which the PMP value is less than as the prior model probabilities change. The default is 0.95. 

**hypothesis**

This has two properties depending on the value of the `reverse` parameter.

When reverse is `TRUE` the value of hypothesis refers to the hypothesis which will be tested against the null. That is to say the given this hypothesis one can give the null hypothesis a certain amount of weight until the result of the analysis changes drastically.


When reverse is `FALSE` the value of hypothesis refers to the hypothesis which will be added weight instead of the null hypothesis. The null is then used to set the boundary. 
The default value for hypothesis is 1. It can take 2 as another input. 


**reverse**

See hypothesis parameter for a detailed description. 

Default value of reverse is `TRUE`.


#### Outputs

**PMP**

Gives the final PMP values corresponding to the PriorMP values.  

**PriorMP**
Gives the final PriorMP corresponding to the PMP values.  

**boundary**

Gives the boundary for when the PMP crosses the threshold.

**threshold**

Value which sets the boundary.

**hypothesis**

Depending on the value on reverse this will change. 

#### Example

```{r BSfactor}
y <- BSfactor( beta = c(0.0126474408, 5.0051724138, 1.2975612498, 0.0004762455),
       se.beta = c(2.538974e-03, 6.662216e+00, 4.219142e+00, 6.963380e-06),
       beta0 = 0, reverse = TRUE , n = 12 )
y
```

### summary.BFcombo

This function provides a summary for  a "BFcombo" object. 

The output of summary consists of a list with the following sections:

**Observed**

This gives a `2 x Number of studies` matrix with the first row being the observed means and the second row being the observed variances with their values rounded to 4 digits.

**uPrior** 

This gives a `2 x Number of studies` matrix with the first row being the unconstrained prior means and the second row being the unconstrained prior variances with their values rounded to 4 digits.


**uPosterior**

This gives a `2 x Number of studies` matrix with the first row being the unconstrained posterior means and the second row being the unconstrained posterior variances with their values rounded to 4 digits.

**BFmu**

This gives a `3 x Number of studies` matrix with the Bayes factors per study rounded to 4 digits. 

**PMP**

This gives a `3 x Number of studies` matrix with the values of the posterior model probabilities rounded to 4 digits. 

#### Example

```{r summary}
summary(x)
```

### summary.BSfactor

This function provides a summary for  a "BSfactor" object. 

The output of summary consists of a list with the following sections:

**PMP**

Gives the first and the last row of the posterior model probabilities, these correspond to the prior model probabilities in the priorMP section.

**priorMP**

Gives the first and the last row of the prior model probabilities, these correspond to the posterior model probabilities in the PMP section.

**boundary**

Gives the boundary value when the PMP value reaches the threshold.

**threshold**

The threshold used to give the boundary.

**hypothesis**

This changes depending on context. See reverse section for BSfactor.

##### Example

```{r summaryBS}

summary(y)

```

###plot

#### For "BFcombo" object

Plot when used on a object of class "BFcombo" will give a visualisation of the observed variances and the prior variances which will be used. This plotting function uses ggplot. 

##### Example

```{r plotBF}
plot(x)
```

#### For "BSfactor" object

Plot when used on a object of class "BSfactor" will give a visualisation of the change in posterior model probability values for each hypothesis as the prior model probabilities are changed. 


##### Example

```{r plotBS, fig.height=4,fig.width=8}
plot(y)
```

### PMP.plot

This function is used on objects of class "BFcombo" and provides a different visualisation to calling the standard plot function. This gives a plot of the prior model probabilities of each hypothesis and their respective posterior model probabilities as they get updated. 

##### Example

```{r PMPplot, fig.height=4,fig.width=6}
PMP.plot(x)
```



# References 

[1] Kuiper RM, Buskens V, Raub W, Hoijtink H (2012). Combining statistical evidence from several studies: A method using Bayesian updating and an example from research on trust problems in social and economic exchange. __Sociological Methods and Research__ 42(1) 60-81.









